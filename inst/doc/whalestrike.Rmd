---
title: "Using the whalestrike package"
author: "Dan Kelley"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
    fig_caption: yes
    fig_width: 5
    fig_height: 5
    dpi: 72
    dev.args: list(pointsize=11)
vignette: >
  %\VignetteIndexEntry{Using the whalestrike package}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

<!-- HOW TO BUILD THE VIGNETTE. -->
<!-- 1. edit this file in vignettes/whalestrike.Rmd -->
<!-- 2. run devtools::build_vignettes() -->
<!-- 3. build the package -->


```{r, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

**Abstract.** This vignette explains the basics of using the whalestrike
package to simulate the collision of a ship with a whale.

# Introduction

This package solves Newton's second law for a simple model of a ship colliding
with a whale. This is a stripped-down model that does not attempt to simulate
the biomechanical interactions that can be simulated in finite-element
treatments such as that of Raymond (2007).  The goal is to establish a
convenient framework for rapid computation of impacts in a wide variety of
conditions. The model runs quickly enough to keep up with mouse movements to
select conditions, in a companion R shiny app. That app lets the user see the
effects of changing contact area, ship speed, etc., as a way to build intuition
for scenarios ranging from collision with a slow-moving fishing boat to
collision with a thin dagger-board of a much swifter racing sailboat. Another
advantage of the simple formulation is that it makes it easy to modify various
dynamical and biomechanical parameters, to add new forces, and to explore a
range of criteria for whale damage.

The documentation for [strike](../help/strike) provides an example of using the
main functions of this package, and so it is a good place to start. A companion
manuscript is intended to provide more detail about the analysis and the
context.

# Examples

## Overview plot

```{r results="hide"}
library(whalestrike)
t <- seq(0, 1, length.out=500)
state <- c(xs=-2.5, vs=10*0.5144, xw=0, vw=0) # 10 knot ship
parms <- parameters(ms=20e3,
                    impactWidth=0.5, impactHeight=1,
                    lw=13,
                    alpha=0.02, Ealpha=2e7, theta=45,
                    beta=0.3, Ebeta=6e5,
                    gamma=0.5, Egamma=4e5)
sol <- strike(t, state, parms)
par(mfcol=c(2, 2), mar=c(2, 3, 0.5, 0.5), mgp=c(2, 0.7, 0), cex=0.7)
plot(sol)
```

## Acceleration dependence on blubber thickness

```{r results="hide"}
library(whalestrike)
t <- seq(0, 1, length.out=500)
state <- c(xs=-1.5, vs=5, xw=0, vw=0)
beta <- seq(0.1, 0.3, length.out=100)
maxAccel <- rep(NA, length(beta))
for (i in seq_along(beta)) {
    parms <- parameters(ms=ms, impactWidth=impactWidth, impactHeight=impactHeight,
                        lw=lw, mw=mw, Sw=Sw,
                        alpha=0.02, Ealpha=2e7, theta=45,
                        beta=beta[i], Ebeta=1e6)
    sol <- strike(t, state, parms)
    maxAccel[i] <- max(abs(diff(sol$vw))) / (t[2] - t[1])
}
plot(beta, maxAccel, type="l", xlab=expression("Blubber thickness [m]"), ylab="Max. Acceleration [m/s^2]")
```

## Blubber-damage dependence on blubber thickness and ship speed

```{r results="hide"}
library(whalestrike)
t <- seq(0, 1, length.out=500)
## Hint: making x and y of different lengths, to avoid row,col
## versus i,j confusion.
beta <- seq(0.1, 0.3, length.out=9)
speedK <- seq(2, 15, length.out=10) # in knots
speed <- 0.5144 * speedK
maxStrain <- matrix(NA, nrow=length(speed), ncol=length(beta))
for (i in seq_along(beta)) {
    for (j in seq_along(speed)) {
        state <- c(xs=-1.5, vs=speed[j], xw=0, vw=0)
        parms <- parameters(ms=ms, impactWidth=impactWidth, impactHeight=impactHeight,
                            lw=lw, mw=mw, Sw=Sw,
                            alpha=0.02, Ealpha=2e7, theta=45,
                            beta=beta[i], Ebeta=1e6)
        sol <- strike(t, state, parms)
        maxStrain[j, i] <- max(sol$WCF$strain)
    }
}
danger <- 0.8 / 1.2
contour(speedK, beta, maxStrain, level=seq(0, danger, 0.1),
        xlab="Speed [knots]", ylab="Blubber thickness [m]")
contour(speedK, beta, maxStrain, level=seq(1, danger, -0.1), lwd=3, add=TRUE)
contour(speedK, beta, maxStrain, level=2/3, lwd=3, lty=2, add=TRUE)
## 2/3 = 0.8/1.2 is Grear et al. 2038 result (page 144, left column) that
## mean (seal) blubber strength is 0.8MPa, whereas mean (seal) blubber
## modulus is 1.2MPa.
mtext("Contours of max strain (dangerous if > 2/3)", side=3)
```


# Further reading

See [whalestrike](../help/whalestrike) for some references to the literature, and
individual help pages for details of the various functions in the package.

